import{_ as X,r as h,a as E,I as C,o as J,x as _,y as m,G as P,T as Q,Q as U,O as q,z as I,J as L,v as k}from"./DfH0JLgj.js";import{s as n}from"./CQEiDZtN.js";import{b as K,m as W,a as Z,c as tt}from"./5NI7ZCqy.js";import{l as et,f as st}from"./BrdkUO9V.js";import"./Gi6I4Gst.js";import"./CmKTTxBW.js";const at={class:"chart-container-transparent"},ot={class:"time-range-controls"},rt=["value"],nt={key:0,class:"error-message"},lt={key:1,class:"loading-spinner"},it="medium_term",ct={__name:"most-played-genres",setup(pt){const T=h([]),j=h([]),y=h(!1),c=h(null),x=h(it),z=[{value:"short_term",text:"Last 4 weeks"},{value:"medium_term",text:"Last 6 months"},{value:"long_term",text:"All time"}],{$axios:D}=E(),A=async()=>{try{y.value=!0,c.value=null;const s=localStorage.getItem("spotify_access_token");if(!s){c.value="No Spotify access token found in localStorage.",y.value=!1;return}const a={Authorization:`Bearer ${s}`},e=await D.get(`/top-genres?time_range=${x.value}`,{headers:a});T.value=e.data.top_genres.map(u=>({genre:u.genre,count:u.count,artists:u.artists})),j.value=Y(T.value)}catch(s){c.value="Error fetching top genres data.",console.error(c.value,s)}finally{y.value=!1}},Y=s=>s.sort((a,e)=>e.count-a.count).slice(0,10),F=s=>{const a=n("#d3-genres-chart").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 1200 1000").classed("svg-content-responsive",!0).style("background-color","transparent");a.selectAll("*").remove();const e={top:20,right:30,bottom:150,left:150},u=1200-e.left-e.right,v=1e3-e.top-e.bottom,$=K().domain(s.map(t=>t.genre)).range([0,u]).padding(.1),M=et().domain([0,W(s,t=>t.count)]).nice().range([v,0]),B=a.append("g").attr("transform",`translate(${e.left},${e.top})`),N=a.append("defs").append("filter").attr("id","drop-shadow").attr("height","130%");N.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",3).attr("result","blur"),N.append("feOffset").attr("in","blur").attr("dx",2).attr("dy",2).attr("result","offsetBlur");const G=N.append("feMerge");G.append("feMergeNode").attr("in","offsetBlur"),G.append("feMergeNode").attr("in","SourceGraphic");const p=n("body").append("div").attr("class","tooltip").style("position","absolute").style("background","#fff").style("border","1px solid #ccc").style("padding","10px").style("border-radius","5px").style("pointer-events","none").style("display","none");let S=!1,f=null;B.append("g").selectAll("rect").data(s).enter().append("rect").attr("class","bar").attr("x",t=>$(t.genre)).attr("y",t=>M(t.count)).attr("width",$.bandwidth()).attr("height",t=>v-M(t.count)).style("fill","steelblue").style("filter","url(#drop-shadow)").on("mouseover",function(t,o){if(S=!0,window.matchMedia("(hover: hover)").matches){const r=o.artists&&o.artists.length>0?o.artists.join(", "):"No artists available",l=5,d=r.split(", ").slice(0,l).join(", "),i=r.split(", ").length>l?"...":"",b=`Artists: ${d}${i}`;p.style("display","block").html(`<strong>${o.genre}</strong><br/>Artists Count: ${o.count}<br/> ${b}`).style("top",t.pageY-10+"px").style("left",t.pageX+10+"px")}n(this).style("fill","darkblue")}).on("mousemove",function(t){window.matchMedia("(hover: hover)").matches&&p.style("top",t.pageY-10+"px").style("left",t.pageX+10+"px")}).on("mouseout",function(){S=!1,p.style("display","none"),n(this).style("fill",function(){return n(this).classed("highlighted")?"darkblue":"steelblue"})}).on("click",function(t,o){if(S&&window.matchMedia("(hover: hover)").matches)return;const r=n(this),l=r.classed("highlighted");if(f&&f!==r&&(f.classed("highlighted",!1).style("fill","steelblue"),p.style("display","none")),l)r.classed("highlighted",!1).style("fill","steelblue"),p.style("display","none"),f=null;else{r.classed("highlighted",!0).style("fill","darkblue");const d=o.artists&&o.artists.length>0?o.artists.join(", "):"No artists available",i=5;d.split(", ").slice(0,i).join(", "),d.split(", ").length>i,p.style("display","block").html(`<strong>${o.genre}</strong><br/>Artists Count: ${o.count}<br/>Artists: ${o.artists.join(", ")}`).style("top",t.pageY-10+"px").style("left",t.pageX+10+"px"),f=r}});const H=B.append("g").attr("transform",`translate(0,${v})`).call(Z($)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end").style("font-size","20px").style("font-family","'Inter', sans-serif").style("font-weight","bold");B.append("g").call(tt(M).tickFormat(st("d"))).selectAll("text").style("font-size","20px").style("font-family","'Inter', sans-serif").style("font-weight","bold"),H.each(function(){n(this).attr("dy","1em").attr("transform","rotate(-45)").attr("text-anchor","end").call(O,150)});function O(t,o){t.each(function(){const r=n(this),l=r.text().split(/\s+/).reverse(),d=1.1,i=r.attr("y"),b=parseFloat(r.attr("dy"));let g=[],V=0,w=r.text(null).append("tspan").attr("x",0).attr("y",i).attr("dy",`${b}em`);for(;l.length>0;){const R=l.pop();g.push(R),w.text(g.join(" ")),w.node().getComputedTextLength()>o&&(g.pop(),w.text(g.join(" ")),g=[R],w=r.append("tspan").attr("x",0).attr("y",i).attr("dy",`${++V*d+b}em`).text(R))}})}a.append("text").attr("x",-(v/2)-e.top).attr("y",e.left-50).attr("transform","rotate(-90)").attr("text-anchor","middle").style("font-size","20px").style("font-family","'Inter', sans-serif").text("Artists").style("font-weight","bold")};return C(j,s=>{s&&s.length>0&&F(s)},{immediate:!0}),C(x,s=>{A()}),J(()=>{A()}),(s,a)=>(k(),_("div",at,[a[2]||(a[2]=m("svg",{id:"d3-genres-chart"},null,-1)),m("div",ot,[a[1]||(a[1]=m("label",{for:"timeRangeSelect",class:"dropdown-label"},"Time Range:",-1)),P(m("select",{id:"timeRangeSelect","onUpdate:modelValue":a[0]||(a[0]=e=>x.value=e),onChange:A,class:"custom-dropdown"},[(k(),_(U,null,q(z,e=>m("option",{key:e.value,value:e.value},I(e.text),9,rt)),64))],544),[[Q,x.value]])]),c.value?(k(),_("div",nt,I(c.value),1)):L("",!0),y.value?(k(),_("div",lt,"Loading...")):L("",!0)]))}},xt=X(ct,[["__scopeId","data-v-685cc166"]]);export{xt as default};
