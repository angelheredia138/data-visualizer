import{s as b}from"./CQEiDZtN.js";import{_ as O,r as w,a as C,o as G,x as k,y as N,z as T,J as M,v as I}from"./DfH0JLgj.js";import{c as W}from"./Du6F06X2.js";const Y={class:"chart-container"},j={key:0,class:"error-message"},D={key:1,class:"loading-spinner"},R={__name:"tree-chart",setup(X){const S=w([]),v=w(!1),x=w(null),{$axios:A}=C(),P=async()=>{try{v.value=!0,x.value=null;const r=localStorage.getItem("spotify_access_token");if(!r){x.value="No Spotify access token found in localStorage.",v.value=!1;return}const t={Authorization:`Bearer ${r}`},l=await A.get("/top-artists/?time_range=long_term",{headers:t});S.value=l.data.items.slice(0,20)||[],$(S.value)}catch(r){x.value="Error fetching data.",console.error(r)}finally{v.value=!1}},$=r=>{const t=b("#d3-christmas-tree-chart").attr("preserveAspectRatio","xMidYMid meet").attr("viewBox","0 0 500 600").classed("svg-content-responsive",!0).style("background-color","transparent");t.selectAll("*").remove();const p=500,l=600,i=t.append("defs").append("filter").attr("id","glow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");i.append("feGaussianBlur").attr("in","SourceGraphic").attr("stdDeviation","4").attr("result","blur"),i.append("feMerge").selectAll("feMergeNode").data(["blur","SourceGraphic"]).enter().append("feMergeNode").attr("in",e=>e);const a=B(r.length,p,l);L(t,a),F(t,a);const o=b("body").append("div").attr("class","tooltip").style("position","absolute").style("background","#fff").style("border","1px solid #ccc").style("padding","10px").style("border-radius","5px").style("pointer-events","none").style("display","none");t.append("rect").attr("x",p/2-15).attr("y",l-181).attr("width",40).attr("height",60).attr("fill","#8B4513");let d=!1;t.selectAll(".ornament").data(r.map(e=>({...e,clicked:!1}))).enter().append("circle").attr("class","ornament").attr("cx",(e,n)=>a[n].x).attr("cy",(e,n)=>a[n].y).attr("r",15).attr("fill",(e,n)=>W[n%10]).style("filter","url(#glow)").on("mouseover",function(e,n){var c;d=!0,n.clicked||o.style("display","block").html(`<div style="display: flex; align-items: center;">
              <img src="${(c=n.images[0])==null?void 0:c.url}" 
                  alt="${n.name}" 
                  style="width: 60px; height: 60px; border-radius: 50%; margin-right: 10px;">
              <strong>${n.name}</strong>
            </div>`).style("top",`${e.pageY-10}px`).style("left",`${e.pageX+10}px`)}).on("mousemove",e=>{if(d){const h=window.innerWidth,g=window.innerHeight;let u=e.pageX+10,s=e.pageY-10;u+200>h&&(u=e.pageX-200-10),s+100>g&&(s=e.pageY-100-10),o.style("top",`${s}px`).style("left",`${u}px`)}}).on("mouseout",function(e,n){d=!1,n.clicked||o.style("display","none")}).on("click",function(e,n){n.clicked=!n.clicked,n.clicked||o.style("display","none")})},B=(r,t,p)=>{const l=[],i=[1,2,3,5,9];let a=0;const o=100,d=(p-o-50)/5,e=20,n=r;for(let c=0;c<5;c++){const h=i[c];let g=o+c*d;(c===4||c===3)&&(g-=20);const u=t/(h+1);for(let s=0;s<h&&a<r;s++,a++){const y=u*(s+1);let m=0;a!==1&&a!==n-2&&(m+=s%2===0?-e:e),s!==0&&s!==h-1&&(m-=10),a===4&&(m-=80),a===2&&(m-=20),a>4&&s!==0&&s!==h-1&&(m-=30);const H=g+m;l.push({x:y,y:H})}}return l},L=(r,t)=>{const l=[1,2,3,5,9],f=[],i=[];let a=0;for(let n=0;n<5;n++){const c=l[n],h=a,g=h;f.push([t[g].x,t[g].y]);const u=h+c-1;i.push([t[u].x,t[u].y]),a+=c}i.reverse();const o=f.concat(i);o.push(o[0]);const e=r.append("defs").append("linearGradient").attr("id","treeGradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("stop-color","#228B22"),e.append("stop").attr("offset","100%").attr("stop-color","#006400"),r.append("polygon").attr("points",o.map(n=>n.join(",")).join(" ")).attr("fill","url(#treeGradient)").attr("opacity",1)},F=(r,t)=>{const l=[1,2,3,5,9],f=["#FFFFFF"];let i=0,a=0;for(let o=0;o<5;o++){const d=l[o],e=i;if(o>0){const n=l[o-1],c=e,h=a;_(r,t[c],t[h],f);const g=e+d-1,u=a+n-1;_(r,t[g],t[u],f);for(let s=1;s<d-1;s++){const y=e+s;_(r,t[y],t[y-1],f),_(r,t[y],t[y+1],f)}}i+=d,a=e}},_=(r,t,p,l)=>{const f=Math.hypot(p.x-t.x,p.y-t.y),i=Math.max(Math.floor(f/20),1),a=[];for(let o=0;o<=i;o++){const d=o/i,e=t.x+d*(p.x-t.x),n=t.y+d*(p.y-t.y);a.push({x:e,y:n,color:l[Math.floor(Math.random()*l.length)]})}r.selectAll(null).data(a).enter().append("circle").attr("cx",o=>o.x).attr("cy",o=>o.y).attr("r",5).attr("fill",o=>o.color).style("filter","url(#glow)")};return G(()=>{P()}),(r,t)=>(I(),k("div",Y,[t[0]||(t[0]=N("svg",{id:"d3-christmas-tree-chart"},null,-1)),x.value?(I(),k("div",j,T(x.value),1)):M("",!0),v.value?(I(),k("div",D,"Loading...")):M("",!0)]))}},J=O(R,[["__scopeId","data-v-df4f14ae"]]);export{J as default};
