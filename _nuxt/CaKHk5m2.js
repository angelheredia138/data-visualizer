import{_ as j,r as u,a as G,i as O,I as B,o as P,x as f,y as m,G as Y,T as D,Q as F,O as V,z as N,J as $,v as y}from"./DgFkfgD6.js";import{s as d}from"./CQEiDZtN.js";import{l as X,f as C}from"./BrdkUO9V.js";import{m as E,b as H,a as J,c as Q}from"./5NI7ZCqy.js";import"./Gi6I4Gst.js";import"./CmKTTxBW.js";const U={class:"chart-container-transparent",style:{flex:"1",padding:"10px"}},q={class:"time-range-controls"},K=["value"],W={key:0,style:{"margin-top":"16px","font-size":"12px",color:"gray"}},Z={key:1,class:"error-message"},ee={key:2,class:"loading-spinner"},te="medium_term",ae={__name:"artist-leaderboard",setup(se){const A=u([]),o=u([]),g=u(!1),r=u(null),h=u(te),L=[{value:"short_term",text:"Last 4 weeks"},{value:"medium_term",text:"Last 6 months"},{value:"long_term",text:"All time"}],{$axios:z}=G(),x=async()=>{try{g.value=!0,r.value=null;const e=localStorage.getItem("spotify_access_token");if(!e){r.value="No Spotify access token found in localStorage.",g.value=!1;return}const t={Authorization:`Bearer ${e}`},a=await z.get(`/top-artists?time_range=${h.value}&limit=10`,{headers:t});A.value=a.data.items,o.value=R(A.value)}catch(e){r.value="Error fetching top artists data.",console.error(r.value,e)}finally{g.value=!1}},R=e=>e.slice(0,10).map(a=>{if(a.name.length>18&&a.name.includes(" ")){const n=a.name.split(" ").map(v=>v[0]).join("");return{...a,displayName:n+"*",fullName:a.name}}else return{...a,displayName:a.name,fullName:a.name}}),M=O(()=>o.value.filter(e=>e.displayName.includes("*")).map(e=>`${e.displayName.replace("*","")}: ${e.fullName}`)),I=()=>{const e=d("#d3-leaderboard").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 1000 800").classed("svg-content-responsive",!0).style("background-color","transparent");e.selectAll("*").remove();const t={top:20,right:30,bottom:150,left:150},a=1e3-t.left-t.right,n=800-t.top-t.bottom,v=X().domain([0,E(o.value,s=>s.popularity)]).nice().range([0,a]),b=H().domain(o.value.map(s=>s.displayName)).range([0,n]).padding(.1),w=e.append("g").attr("transform",`translate(${t.left},${t.top})`),_=e.append("defs").append("filter").attr("id","drop-shadow").attr("height","130%");_.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",3).attr("result","blur"),_.append("feOffset").attr("in","blur").attr("dx",2).attr("dy",2).attr("result","offsetBlur");const S=_.append("feMerge");S.append("feMergeNode").attr("in","offsetBlur"),S.append("feMergeNode").attr("in","SourceGraphic");const i=d("body").append("div").attr("class","tooltip").style("position","absolute").style("background","#fff").style("border","1px solid #ccc").style("padding","10px").style("border-radius","5px").style("pointer-events","none").style("display","none");let k=!1,p=null;w.append("g").selectAll("rect").data(o.value).enter().append("rect").attr("x",0).attr("y",s=>b(s.displayName)).attr("width",s=>v(s.popularity)).attr("height",b.bandwidth()).style("fill","steelblue").style("filter","url(#drop-shadow)").on("mouseover",function(s,l){k=!0,window.matchMedia("(hover: hover)").matches&&i.style("display","block").html(`<strong>${l.fullName}</strong><br/>Popularity: ${l.popularity}<br/>Genres: ${l.genres.join(", ")}`).style("top",s.pageY-10+"px").style("left",s.pageX+10+"px"),d(this).style("fill","darkblue")}).on("mousemove",function(s){window.matchMedia("(hover: hover)").matches&&i.style("top",s.pageY-10+"px").style("left",s.pageX+10+"px")}).on("mouseout",function(){k=!1,i.style("display","none"),d(this).style("fill",function(){return d(this).classed("highlighted")?"darkblue":"steelblue"})}).on("click",function(s,l){if(k&&window.matchMedia("(hover: hover)").matches)return;const c=d(this),T=c.classed("highlighted");p&&p!==c&&(p.classed("highlighted",!1).style("fill","steelblue"),i.style("display","none")),T?(c.classed("highlighted",!1).style("fill","steelblue"),i.style("display","none"),p=null):(c.classed("highlighted",!0).style("fill","darkblue"),i.style("display","block").html(`<strong>${l.fullName}</strong><br/>Popularity: ${l.popularity}<br/>Genres: ${l.genres.join(", ")}`).style("top",s.pageY-10+"px").style("left",s.pageX+10+"px"),p=c)}),w.append("g").attr("transform",`translate(0,${n})`).call(J(v).tickFormat(C("d"))).selectAll("text").style("font-size","20px").style("font-family","'Inter', sans-serif").style("font-weight","bold"),w.append("g").call(Q(b).tickSize(0)).selectAll("text").style("font-size","20px").style("font-family","'Inter', sans-serif").style("font-weight","bold").attr("transform","translate(-10,0) rotate(-45)").style("text-anchor","end"),e.append("text").attr("x",a/2+t.left).attr("y",n+t.top+50).attr("text-anchor","middle").style("font-size","20px").style("font-family","'Inter', sans-serif").style("font-weight","bold").text("Popularity"),e.append("foreignObject").attr("x",t.left).attr("y",n+t.top+65).attr("width",a).attr("height",100).append("xhtml:div").style("font-size","20px").style("font-family","'Inter', sans-serif").style("font-weight","normal").style("color","#333").style("text-align","center").html("Popularity is a metric provided by Spotify that indicates how popular an artist is based on the number of streams, album sales, and other factors.")};return B(o,e=>{e.length>0&&I()},{immediate:!0}),B(h,e=>{x()}),P(()=>{x()}),(e,t)=>(y(),f("div",U,[t[2]||(t[2]=m("svg",{id:"d3-leaderboard"},null,-1)),m("div",q,[t[1]||(t[1]=m("label",{for:"timeRangeSelect",class:"dropdown-label"},"Time Range:",-1)),Y(m("select",{id:"timeRangeSelect","onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),onChange:x,class:"custom-dropdown"},[(y(),f(F,null,V(L,a=>m("option",{key:a.value,value:a.value},N(a.text),9,K)),64))],544),[[D,h.value]])]),M.value.length>0?(y(),f("p",W," * Full artist names: "+N(M.value.join(", ")),1)):$("",!0),r.value?(y(),f("div",Z,N(r.value),1)):$("",!0),g.value?(y(),f("div",ee,"Loading...")):$("",!0)]))}},ce=j(ae,[["__scopeId","data-v-e9dcef71"]]);export{ce as default};
